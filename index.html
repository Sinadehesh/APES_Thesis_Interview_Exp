<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interview Demo</title>
  <style>
    body { display: flex; justify-content: center; align-items: center; min-height: 100vh; margin:0; font-family: 'Segoe UI', Tahoma, sans-serif; background:#f0f2f5; }
    .container { width:600px; max-width:90vw; padding:30px; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center; }
    .hidden { display:none; }
    input, button { width:100%; padding:12px; margin:10px 0; font-size:1em; }
    button { border:none; border-radius:6px; cursor:pointer; background:#1976d2; color:#fff; }
    button:hover { background:#145a9e; }
    #startRecordingBtn { background:#d32f2f; }
    #startRecordingBtn:hover { background:#9a2424; }
    .status-row { display:flex; justify-content:space-between; align-items:center; margin:20px 0; }
    .status-row span { font-weight:bold; }
    .video-prompt, #viewContainer img, .preview-video { width:100%; border-radius:6px; }
    .radio-group { display:flex; flex-direction:column; align-items:flex-start; margin:20px 0; }
    .radio-group label { margin:5px 0; cursor:pointer; }
  </style>
</head>
<body>
  <!-- STEP 1: Name & Job -->
  <div id="startPage" class="container">
    <h1>Welcome!</h1>
    <p>Enter your name and the job you’re interviewing for:</p>
    <input type="text" id="participantName" placeholder="Your name" />
    <input type="text" id="participantJob" placeholder="Desired job" />
    <button id="startIntroBtn">Next</button>
  </div>

  <!-- STEP 2: Intro -->
  <div id="introPage" class="container hidden">
    <h2>Hi <span id="displayName"></span>!</h2>
    <p>Imagine you’re interviewing for <strong><span id="displayJob"></span></strong>. It’s a job you really want—do your best!</p>
    <p>After every two questions, you’ll answer a quick check-in.</p>
    <button id="startInterviewBtn">Start Interview</button>
  </div>

  <!-- INTERVIEW -->
  <div id="interviewPage" class="container hidden">
    <p id="questionText"></p>
    <div id="viewContainer"></div>
    <p id="recordInstruction">Click <strong>Start Recording</strong>. You have 30s.</p>
    <button id="startRecordingBtn">Start Recording</button>
    <div class="status-row">
      <span id="redoCount">Redo: 0</span>
      <div id="recordIndicator" style="width:20px;height:20px;background:red;border-radius:50%;visibility:hidden;"></div>
      <span id="timerDisplay" style="color:red;visibility:hidden;">30</span>
    </div>
    <div style="display:flex;gap:10px;">
      <button id="redoBtn" style="flex:1;">Redo</button>
      <button id="finishBtn" style="flex:1;">Finish</button>
    </div>
  </div>

  <!-- PREVIEW -->
  <div id="previewPage" class="container hidden">
    <h2>Your Recording</h2>
    <video id="previewVideo" class="preview-video" controls></video>
    <div style="display:flex;gap:10px;">
      <button id="previewRedoBtn" style="flex:1;">Redo</button>
      <button id="previewNextBtn" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- SURVEY -->
  <div id="surveyPage" class="container hidden">
    <h2>Quick Check-In</h2>
    <p id="surveyRound"></p>
    <h3 id="surveyQuestion"></h3>
    <div id="surveyOptions" class="radio-group"></div>
    <button id="surveySubmitBtn">Submit</button>
    <p><small id="surveyProgress"></small></p>
  </div>

  <!-- END -->
  <div id="endPage" class="container hidden">
    <h2>Thank You!</h2>
    <p>You’ve completed the interview. We appreciate your time!</p>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Post-condition questions
    const postQs = [
      { id:"q1", text:"I felt anxious during this interview.", scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] },
      { id:"q2", text:"I was able to express myself clearly.", reverse:true, scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] },
      { id:"q3", text:"This format made it hard to show my abilities.", scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] }
    ];

    // DOM refs
    const startPage        = $('#startPage'),
          introPage        = $('#introPage'),
          interviewPage    = $('#interviewPage'),
          previewPage      = $('#previewPage'),
          surveyPage       = $('#surveyPage'),
          endPage          = $('#endPage'),
          displayName      = $('#displayName'),
          displayJob       = $('#displayJob'),
          qText            = $('#questionText'),
          viewContainer    = $('#viewContainer'),
          recordInst       = $('#recordInstruction'),
          redoCountSp     = $('#redoCount'),
          recIndicator     = $('#recordIndicator'),
          timerSp          = $('#timerDisplay'),
          previewVideo     = $('#previewVideo'),
          surveyRound      = $('#surveyRound'),
          surveyQuestion   = $('#surveyQuestion'),
          surveyOptions    = $('#surveyOptions'),
          surveyProgress   = $('#surveyProgress');

    const startIntroBtn    = $('#startIntroBtn'),
          startInterviewBtn= $('#startInterviewBtn'),
          startRecBtn      = $('#startRecordingBtn'),
          redoBtn          = $('#redoBtn'),
          finishBtn        = $('#finishBtn'),
          previewRedoBtn   = $('#previewRedoBtn'),
          previewNextBtn   = $('#previewNextBtn'),
          surveySubmitBtn  = $('#surveySubmitBtn');

    // interview data
    const Qs = [
      "Tell me about yourself.",
      "What are your strengths?",
      "What are your weaknesses?",
      "Why do you want this job?",
      "Describe a time you overcame a challenge.",
      "Where do you see yourself in five years?"
    ];
    const conds = [1,1,2,2,3,3];
    const vidFiles = [null,null,"0729-1.mp4","0729-2.mp4",null,null];

    let idx=0, redoCounts=Array(Qs.length).fill(0), mediaRec, 
        recChunks=[], stream, surveyIdx=0, responses={};

    // util to get by id
    function $(id){ return document.getElementById(id); }

    // Show/Hide helpers
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    // STEP1
    startIntroBtn.onclick = ()=>{
      const name = $('#participantName').value.trim();
      const job  = $('#participantJob').value.trim();
      if(!name||!job) return alert("Enter both name & job.");
      displayName.textContent = name;
      displayJob.textContent  = job;
      hide(startPage);
      show(introPage);
    };

    // STEP2
    startInterviewBtn.onclick = ()=>{
      hide(introPage);
      show(interviewPage);
      showQuestion();
    };

    // get media
    navigator.mediaDevices.getUserMedia({video:true,audio:true})
      .then(s=>stream=s).catch(e=>alert("Allow camera."));

    // show question
    function showQuestion(){
      // after Q2,Q4 -> survey
      if(idx>0 && idx%2===0){ return showSurvey(); }
      // end?
      if(idx>=Qs.length){ hide(interviewPage); show(endPage); return; }

      hide(previewPage); hide(surveyPage); show(interviewPage);
      qText.textContent = Qs[idx];
      redoCountSp.textContent = `Redo: ${redoCounts[idx]}`;
      viewContainer.innerHTML = '';
      recordInst.style.display='block';
      startRecBtn.style.display='block';
      recIndicator.style.visibility='hidden';
      timerSp.style.visibility='hidden';

      if(conds[idx]===1 && stream){
        const v=document.createElement('video');
        v.srcObject=stream; v.autoplay=v.muted=v.playsInline=true; v.className='video-prompt';
        viewContainer.appendChild(v);
      }
      else if(conds[idx]===2){
        const v=document.createElement('video');
        v.src=vidFiles[idx]; v.controls=v.autoplay=true; v.className='video-prompt';
        viewContainer.appendChild(v);
      }
      // cond 3: text only
    }

    // record
    startRecBtn.onclick = ()=>{
      recChunks=[]; mediaRec=new MediaRecorder(stream);
      mediaRec.ondataavailable=e=>e.data.size&&recChunks.push(e.data);
      mediaRec.onstop=()=>{
        const blob=new Blob(recChunks,{type:'video/webm'});
        previewVideo.src=URL.createObjectURL(blob);
        hide(interviewPage); show(previewPage);
      };
      mediaRec.start();
      recordInst.style.display='none';
      startRecBtn.style.display='none';
      recIndicator.style.visibility='visible';
      timerSp.style.visibility='visible';
      if(conds[idx]===2){
        viewContainer.innerHTML='';
        const img=document.createElement('img');
        img.src='input.jpg'; img.className='video-prompt';
        viewContainer.appendChild(img);
      }
      startTimer();
    };

    // timer
    function startTimer(){
      let t=30; timerSp.textContent=t;
      timerSp._timer=setInterval(()=>{
        t--; timerSp.textContent=t;
        if(t<=0){ clearInterval(timerSp._timer); mediaRec.stop(); }
      },1000);
    }

    // redo
    function doRedo(){
      if(mediaRec && mediaRec.state==='recording') mediaRec.stop();
      clearInterval(timerSp._timer);
      redoCounts[idx]++;
      showQuestion();
    }
    redoBtn.onclick=doRedo;
    previewRedoBtn.onclick=doRedo;

    // finish stops recording
    finishBtn.onclick=()=>mediaRec&&mediaRec.state==='recording'&&mediaRec.stop();

    // preview next
    previewNextBtn.onclick=()=>{
      previewVideo.pause(); previewVideo.currentTime=0;
      if(mediaRec&&mediaRec.state==='recording') mediaRec.stop();
      clearInterval(timerSp._timer);
      idx++;
      showQuestion();
    };

    // SURVEY
    function showSurvey(){
      hide(interviewPage); hide(previewPage); show(surveyPage);
      surveyIdx=0;
      const condName = conds[idx-1]===1?'Mirror':conds[idx-1]===2?'Avatar':'Text-only';
      surveyRound.textContent = `After ${condName} segment`;
      renderSurvey();
    }

    function renderSurvey(){
      const q=postQs[surveyIdx];
      surveyQuestion.textContent=q.text;
      surveyOptions.innerHTML='';
      q.scale.forEach((opt,i)=>{
        const lbl=document.createElement('label');
        lbl.innerHTML=`<input type="radio" name="surveyOpt" value="${i+1}"> ${opt}`;
        surveyOptions.appendChild(lbl);
      });
      surveyProgress.textContent=`${surveyIdx+1} of ${postQs.length}`;
    }

    surveySubmitBtn.onclick=()=>{
      const sel = document.querySelector('input[name="surveyOpt"]:checked');
      if(!sel) return alert("Choose an option");
      responses[postQs[surveyIdx].id + `_cond${Math.ceil(idx/2)}`] = sel.value;
      surveyIdx++;
      if(surveyIdx<postQs.length) renderSurvey();
      else { hide(surveyPage); showQuestion(); }
    };
  });
  </script>
</body>
</html>
