<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interview Demo (No Surveys)</title>
  <style>
    body { display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; font-family:'Segoe UI', Tahoma, sans-serif; background:#f0f2f5; }
    .container { width:600px; max-width:90vw; padding:30px; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center; }
    .hidden { display:none; }
    input, button { width:100%; padding:12px; margin:10px 0; font-size:1em; }
    button { border:none; border-radius:6px; cursor:pointer; background:#1976d2; color:#fff; }
    button:hover { background:#145a9e; }
    #startRecordingBtn { background:#d32f2f; }
    #startRecordingBtn:hover { background:#9a2424; }
    .status-row { display:flex; justify-content:space-between; align-items:center; margin:20px 0; }
    .status-row span { font-weight:bold; }
    .video-prompt, #viewContainer img, .preview-video { width:100%; border-radius:6px; }

    /* inline survey options in one row */
    /* one-row radio options */
#surveyOptions {
  display: flex;
  flex-wrap: nowrap;
  gap: 14px;
  align-items: center;
  justify-content: center;
  overflow-x: auto; /* scroll if too tight */
}
#surveyOptions label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}
    .radio-row {
      display:flex;
      flex-wrap:nowrap;      /* single row */
      gap:14px;
      justify-content:center;
      align-items:center;
      white-space:nowrap;
      overflow-x:auto;       /* scroll horizontally if too tight */
      padding:8px 0;
    }
    .radio-row label {
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      user-select:none;
    }
    .radio-row input[type="radio"] { transform:translateY(1px); }
  </style>
</head>
<body>
  <!-- STEP 1: Name & Job -->
  <div id="startPage" class="container">
    <h1>Welcome!</h1>
    <p>Enter your name, then the job title you hope to get:</p>
    <input type="text" id="participantName" placeholder="Your name" />
    <input type="text" id="participantJob" placeholder="Desired job" />
    <button id="startIntroBtn">Next</button>
  </div>

  <!-- STEP 2: Intro -->
  <div id="introPage" class="container hidden">
    <h2>Hi <span id="displayName"></span>!</h2>
    <p>You’ll complete 3 interview formats for a <strong><span id="displayJob"></span></strong> role. Record your answers; if you’re not satisfied, hit “Redo.” Only you will see the videos.</p>
    <button id="startInterviewBtn">Start Interview</button>
  </div>

  <!-- INTERVIEW -->
  <div id="interviewPage" class="container hidden">
    <p id="questionText"></p>
    <div id="viewContainer"></div>
    <p id="recordInstruction">Click <strong>Start Recording</strong>. You have 30s.</p>
    <button id="startRecordingBtn">Start Recording</button>
    <div class="status-row">
      <span id="redoCount">Redo: 0</span>
      <div id="recordIndicator" style="width:20px;height:20px;background:red;border-radius:50%;visibility:hidden;"></div>
      <span id="timerDisplay" style="color:red;visibility:hidden;">30</span>
    </div>
    <div style="display:flex;gap:10px;">
      <button id="redoBtn" style="flex:1;">Redo</button>
      <button id="finishBtn" style="flex:1;">Finish</button>
    </div>
  </div>

  <!-- PREVIEW -->
  <div id="previewPage" class="container hidden">
    <h2>Your Recording</h2>
    <video id="previewVideo" class="preview-video" controls></video>
    <div style="display:flex;gap:10px;">
      <button id="previewRedoBtn" style="flex:1;">Redo</button>
      <button id="previewNextBtn" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- SURVEY (minimal; no header text like "Quick Check-In") -->
  <div id="surveyPage" class="container hidden">
    <h3 id="surveyQuestion" style="margin-top:0;"></h3>
    <div id="surveyOptions" class="radio-row"></div>
    <button id="surveySubmitBtn">Submit</button>
    <p><small id="surveyProgress"></small></p>
  </div>

  <!-- END -->
  <div id="endPage" class="container hidden">
    <h2>Thank You!</h2>
    <p>You’ve completed the interview. We appreciate your time!</p>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $ = s => document.getElementById(s.startsWith('#') ? s.slice(1) : s);
    const show = el => el.classList.remove('hidden');
    const hide = el => el.classList.add('hidden');

    // DOM refs
    const startPage = $('#startPage'), introPage = $('#introPage'),
          interviewPage = $('#interviewPage'), previewPage = $('#previewPage'),
          surveyPage = $('#surveyPage'), endPage = $('#endPage');

    const displayName = $('#displayName'), displayJob = $('#displayJob'),
          qText = $('#questionText'), viewContainer = $('#viewContainer'),
          recordInst = $('#recordInstruction'), redoCountSp = $('#redoCount'),
          recIndicator = $('#recordIndicator'), timerSp = $('#timerDisplay'),
          previewVideo = $('#previewVideo');

    const startIntroBtn = $('#startIntroBtn'), startInterviewBtn = $('#startInterviewBtn'),
          startRecBtn = $('#startRecordingBtn'), redoBtn = $('#redoBtn'),
          finishBtn = $('#finishBtn'), previewRedoBtn = $('#previewRedoBtn'),
          previewNextBtn = $('#previewNextBtn');

    const surveyQuestion = $('#surveyQuestion'),
          surveyOptions = $('#surveyOptions'),
          surveyProgress = $('#surveyProgress'),
          surveySubmitBtn = $('#surveySubmitBtn');

    // Interview data: 6 questions, conditions 1/1/2/2/3/3
    const Qs = [
      "Tell me about yourself.",                    // cond 1 (mirror)
      "What are your strengths?",                   // cond 1 (mirror)
      "— video prompt —",                           // cond 2 (avatar video → picture during answer)
      "— video prompt —",                           // cond 2
      "Describe a time you overcame a challenge.",  // cond 3 (text/voice-only)
      "Where do you see yourself in five years?"    // cond 3 (text/voice-only)
    ];
    const conds    = [1,1,2,2,3,3];
    const vidFiles = [null,null,"0729-1.mp4","0729-2.mp4",null,null];

    // Minimal post-condition survey (after Q2, Q4) — ONLY change is item 3 text + inline options
    const postQs = [
      { id:"q1", text:"I felt anxious during this interview.", scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] },
      { id:"q2", text:"I was able to express myself clearly.", reverse:true, scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] },
      { id:"q3", text:"I felt I would be judged more negatively.", scale:["Strongly disagree","Disagree","Neutral","Agree","Strongly agree"] }
    ];

    let idx = 0;
    let redoCounts = Array(Qs.length).fill(0);
    let stream = null, mediaRec = null, recChunks = [];
    let surveyIdx = 0;

    // STEP 1
    startIntroBtn.onclick = () => {
      const name = $('participantName').value.trim();
      const job  = $('participantJob').value.trim();
      if (!name || !job) return alert("Enter both name & job.");
      displayName.textContent = name;
      displayJob.textContent  = job;
      hide(startPage); show(introPage);
    };

    // STEP 2
    startInterviewBtn.onclick = () => { hide(introPage); show(interviewPage); showQuestion(); };

    // Camera/mic
    navigator.mediaDevices.getUserMedia({ video:true, audio:true })
      .then(s => { stream = s; })
      .catch(() => alert("Camera/microphone access is required."));

    function showQuestion() {
      if (idx >= Qs.length) { hide(interviewPage); show(endPage); return; }

      hide(previewPage); hide(surveyPage); show(interviewPage);

      // Question text (empty for avatar/video prompts)
      qText.textContent = (conds[idx] === 2) ? "" : Qs[idx];

      redoCountSp.textContent = `Redo: ${redoCounts[idx]}`;
      viewContainer.innerHTML = '';
      recordInst.style.display = 'block';
      startRecBtn.style.display = 'block';
      recIndicator.style.visibility = 'hidden';
      timerSp.style.visibility = 'hidden';

      if (conds[idx] === 1 && stream) {
        // Mirror: live webcam feed
        const v = document.createElement('video');
        v.srcObject = stream;
        v.autoplay = v.muted = v.playsInline = true;
        v.className = 'video-prompt';
        viewContainer.appendChild(v);
      } else if (conds[idx] === 2) {
        // Avatar: show the prompt video (no text)
        const v = document.createElement('video');
        v.src = vidFiles[idx];
        v.controls = v.autoplay = true;
        v.playsInline = true;
        v.className = 'video-prompt';
        viewContainer.appendChild(v);
      }
      // cond 3: text-only
    }

    // Start recording
    startRecBtn.onclick = () => {
      if (!stream) return alert('No camera stream. Reload and allow access.');

      recChunks = [];
      mediaRec = new MediaRecorder(stream);
      mediaRec.ondataavailable = e => { if (e.data && e.data.size) recChunks.push(e.data); };
      mediaRec.onstop = () => {
        const blob = new Blob(recChunks, { type: 'video/webm' });
        previewVideo.src = URL.createObjectURL(blob);
        hide(interviewPage); show(previewPage);
      };
      mediaRec.start();

      recordInst.style.display = 'none';
      startRecBtn.style.display = 'none';
      recIndicator.style.visibility = 'visible';
      timerSp.style.visibility = 'visible';

      // During avatar condition, swap video → static image while answering
      if (conds[idx] === 2) {
        viewContainer.innerHTML = '';
        const img = document.createElement('img');
        img.src = 'input.jpg';  // avatar image
        img.alt = '';
        img.className = 'video-prompt';
        viewContainer.appendChild(img);
      }

      startTimer();
    };

    function startTimer() {
      let t = 30;
      timerSp.textContent = t;
      if (timerSp._timer) clearInterval(timerSp._timer);
      timerSp._timer = setInterval(() => {
        t--; timerSp.textContent = t;
        if (t <= 0) {
          clearInterval(timerSp._timer);
          if (mediaRec && mediaRec.state !== 'inactive') mediaRec.stop();
        }
      }, 1000);
    }

    function doRedo() {
      if (mediaRec && mediaRec.state === 'recording') mediaRec.stop();
      if (timerSp._timer) clearInterval(timerSp._timer);
      redoCounts[idx]++;
      showQuestion();
    }
    redoBtn.onclick = doRedo;
    previewRedoBtn.onclick = doRedo;

    finishBtn.onclick = () => { if (mediaRec && mediaRec.state === 'recording') mediaRec.stop(); };

    // Preview → Next question (show survey only after Q2 and Q4)
    previewNextBtn.onclick = () => {
      previewVideo.pause(); previewVideo.currentTime = 0;
      if (mediaRec && mediaRec.state === 'recording') mediaRec.stop();
      if (timerSp._timer) clearInterval(timerSp._timer);
      idx++;
      if (idx === 2 || idx === 4) {
        showSurvey();
      } else {
        showQuestion();
      }
    };

    // --- Minimal Survey (no “Quick Check-In” header) ---
    function showSurvey() {
      hide(interviewPage); hide(previewPage); show(surveyPage);
      surveyIdx = 0;
      renderSurvey();
    }

    function renderSurvey() {
      const q = postQs[surveyIdx];
      surveyQuestion.textContent = q.text;
      surveyOptions.innerHTML = '';
      q.scale.forEach((opt, i) => {
        const lbl = document.createElement('label');
        lbl.innerHTML = `<input type="radio" name="surveyOpt" value="${i+1}"> ${opt}`;
        surveyOptions.appendChild(lbl);
      });
      surveyProgress.textContent = `${surveyIdx + 1} of ${postQs.length}`;
    }

    surveySubmitBtn.onclick = () => {
      const sel = document.querySelector('input[name="surveyOpt"]:checked');
      if (!sel) return alert('Choose an option.');
      surveyIdx++;
      if (surveyIdx < postQs.length) {
        renderSurvey();
      } else {
        hide(surveyPage);
        showQuestion(); // continue to next question
      }
    };

    // Cleanup
    window.addEventListener('beforeunload', () => {
      if (stream) stream.getTracks().forEach(t => t.stop());
      if (timerSp._timer) clearInterval(timerSp._timer);
    });
  });
  </script>
</body>
</html>
